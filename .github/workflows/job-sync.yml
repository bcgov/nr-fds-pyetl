name: ETL Sync

on:
  # schedule: [cron: "0 */2 * * *"] # Every other hour on the hour
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  sync-test:
    environment: test
    name: Sync (TEST)
    runs-on: ubuntu-24.04
    steps:
      - name: ETL (TEST)
        uses: bcgov/action-oc-runner@v0.3.0
        with:
          oc_namespace: ${{ vars.OC_NAMESPACE }}
          oc_server: ${{ vars.OC_SERVER }}
          oc_token: ${{ secrets.OC_TOKEN }}
          triggers: ('sync/')
          command: ./sync/oc_run.sh test ${{ secrets.oc_token }}

  sync-prod:
    environment: prod
    name:
    runs-on: ubuntu-24.04
    steps:
      - name: Sync (PROD)
        uses: bcgov/action-oc-runner@v0.3.0
        with:
          oc_namespace: ${{ vars.OC_NAMESPACE }}
          oc_server: ${{ vars.OC_SERVER }}
          oc_token: ${{ secrets.OC_TOKEN }}
          triggers: ('sync/')
          command: ./sync/oc_run.sh prod ${{ secrets.oc_token }}
